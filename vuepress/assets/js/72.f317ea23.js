(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{478:function(t,s,a){t.exports=a.p+"assets/img/observer001.39b98ba0.gif"},479:function(t,s,a){t.exports=a.p+"assets/img/intersectratio.9bc316a3.png"},678:function(t,s,a){"use strict";a.r(s);var e=a(12),n=Object(e.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"js中的观察者们-——-四种-observers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#js中的观察者们-——-四种-observers","aria-hidden":"true"}},[t._v("#")]),t._v(" JS中的观察者们 —— 四种 Observers")]),t._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://xiaotianxia.github.io/blog/vuepress/js/four_kinds_of_observers.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("今天跟大家一块学习一下JS中的几个观察者(Observer) API，他们是 ——")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#intersection-observer"}},[t._v("Intersection Observer")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#mutation-observer"}},[t._v("Mutation Observer")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#resize-observer"}},[t._v("Resize Observer")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#performance-observer"}},[t._v("Performance Observer")])])]),t._v(" "),e("h2",{attrs:{id:"intersection-observer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#intersection-observer","aria-hidden":"true"}},[t._v("#")]),t._v(" Intersection Observer")]),t._v(" "),e("p",[t._v("当你想监听某个元素，当它在视口中可见的时候希望可以得到通知，这个API就是最佳的选择了。以往我们的做法是绑定容器的scroll事件，或者设定时器不停地调用getBoundingClientRect() 获取元素位置，\n这样做的性能会很差，因为每次获取元素的位置都会引起整个布局的重新计算。还有一个场景是，如果你的元素被放在iframe里，如一些广告，想要知道他们何时出现几乎是不可能的。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(478),alt:"demo"}})]),t._v(" "),e("p",[t._v("现在，我们完全可以把这些工作交给IntersectionObserver了。")]),t._v(" "),e("h3",{attrs:{id:"怎么用？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么用？","aria-hidden":"true"}},[t._v("#")]),t._v(" 怎么用？")]),t._v(" "),e("p",[t._v("实例化一个观察器：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IntersectionObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("callback 是一个回调函数，里面返回监听目标元素的实时数据组成的数组\n"),e("ul",[e("li",[t._v("time 时间戳")]),t._v(" "),e("li",[t._v("rootBounds 根元素的位置信息")]),t._v(" "),e("li",[t._v("boundingClientRect 目标元素的位置信息")]),t._v(" "),e("li",[t._v("intersectionRect 交叉部分的位置信息")]),t._v(" "),e("li",[t._v("intersectionRatio 目标元素的可见比例，看下图示")]),t._v(" "),e("li",[t._v("target等")])])]),t._v(" "),e("li",[t._v("options 是一些配置\n"),e("ul",[e("li",[t._v("root 目标元素的"),e("strong",[t._v("祖先元素")]),t._v("，即该元素必须是目标元素的直接或间接父级")]),t._v(" "),e("li",[t._v("rootMargin 一个在计算交叉值时添加至root的边界盒中的一组偏移量，写法类似CSS的margin")]),t._v(" "),e("li",[t._v("threshold 规定了一个监听目标与边界盒交叉区域的比例值，可以是一个具体的数值或是一组0.0到1.0之间的数组")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(479),alt:"smalldemo"}})]),t._v(" "),e("p",[t._v("开始监听元素：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("这两步之后，就可以在callback里补全业务代码了。")]),t._v(" "),e("p",[t._v("此外，还有两个方法：")]),t._v(" "),e("ul",[e("li",[t._v("停止对某目标的监听")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("unobserve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("终止对所有目标的监听")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("disconnect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h3",{attrs:{id:"demo-🌰↓"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#demo-🌰↓","aria-hidden":"true"}},[t._v("#")]),t._v(" demo 🌰↓")]),t._v(" "),e("p",[t._v("做一个视频流的简单demo，当视频滚动到全部出现在屏幕的时候播放，并暂停其他“滚出”屏幕的或者还未“滚进来”的视频。")]),t._v(" "),e("p",[t._v("（滚动看效果，括号里显示的是每个元素在观察视口的可见比例）")]),t._v(" "),e("Observers-IntersectionObserver"),t._v(" "),e("p",[t._v("主要代码：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("methods"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("reserveCallback")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entries"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ratio "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" entries"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("intersectionRatio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t$target "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" entries"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ratio "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.03")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPlay")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPlay")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//播放视频")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPause")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//暂停视频")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("addObserver")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$targets"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" len "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $targets"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" len"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始监听")]),t._v("\n    \t\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$targets"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" $referenceBox "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js-content'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t$targets "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelectorAll")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js-item'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//实例化观察器")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IntersectionObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reserveCallback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \troot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $referenceBox"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \trootMargin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0px'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \tthreshold"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.9")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("addObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$targets"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br"),e("span",{staticClass:"line-number"},[t._v("29")]),e("br"),e("span",{staticClass:"line-number"},[t._v("30")]),e("br"),e("span",{staticClass:"line-number"},[t._v("31")]),e("br"),e("span",{staticClass:"line-number"},[t._v("32")]),e("br"),e("span",{staticClass:"line-number"},[t._v("33")]),e("br"),e("span",{staticClass:"line-number"},[t._v("34")]),e("br"),e("span",{staticClass:"line-number"},[t._v("35")]),e("br"),e("span",{staticClass:"line-number"},[t._v("36")]),e("br"),e("span",{staticClass:"line-number"},[t._v("37")]),e("br")])]),e("p",[e("a",{attrs:{href:"https://github.com/xiaotianxia/blog/blob/678a850ab72f9c6cc302c5c4dc0ec6f4a61de5d5/docs/.vuepress/components/Observers/IntersectionObserver.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("完整代码"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("上面的demo也有很大的不足之处：对所有的视频元素都进行了监听，并且对“消失”的视频没有关掉观察器，当视频数增多时，势必会引起性能上的问题。\n如果真的应用在业务中还需要进一步的优化。")]),t._v(" "),e("h3",{attrs:{id:"其他应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他应用","aria-hidden":"true"}},[t._v("#")]),t._v(" 其他应用")]),t._v(" "),e("p",[t._v("除了上面提到的广告展示，还可以做懒加载：在列表的底部设置一个用来监听的元素，当它出现时，加载更多的内容，同时改变该监听元素的位置到底部继续监听。")]),t._v(" "),e("p",[t._v("除了这些，还可以做什么呢？")]),t._v(" "),e("h3",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/2018/WD-intersection-observer-20181106/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intersection Observer"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developers.google.com/web/updates/2016/04/intersectionobserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("IntersectionObserver’s Coming into View"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://davidwalsh.name/intersection-observers",target:"_blank",rel:"noopener noreferrer"}},[t._v("Observing Intersection Observers"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("IntersectionObserver"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/w3c/IntersectionObserver/tree/master/polyfill",target:"_blank",rel:"noopener noreferrer"}},[t._v("IntersectionObserver polyfill"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"mutation-observer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mutation-observer","aria-hidden":"true"}},[t._v("#")]),t._v(" Mutation Observer")]),t._v(" "),e("p",[t._v("当我们想知道某个元素在某个时候发生了具体哪些变化时，MutationObserver便是最佳选择了。")]),t._v(" "),e("h3",{attrs:{id:"怎么用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么用","aria-hidden":"true"}},[t._v("#")]),t._v(" 怎么用")]),t._v(" "),e("p",[t._v("实例化一个观察器：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MutationObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("开始监听：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("config 填写需要监听属性\n"),e("ul",[e("li",[t._v("attributes 布尔类型 属性的变动")]),t._v(" "),e("li",[t._v("childList 布尔类型 子节点的变动（指新增，删除或者更改）")]),t._v(" "),e("li",[t._v("characterData 布尔类型 节点内容或节点文本的变动。")]),t._v(" "),e("li",[t._v("subtree 布尔类型 是否将该观察器应用于该节点的所有后代节点")]),t._v(" "),e("li",[t._v("attributeOldValue 布尔类型 观察attributes变动时，是否需要记录变动前的属性值")]),t._v(" "),e("li",[t._v("characterDataOldValue 布尔类型 观察characterData变动时，是否需要记录变动前的值")]),t._v(" "),e("li",[t._v("attributeFilter 数组 需要观察的特定属性（比如['class','src']）")])])])]),t._v(" "),e("p",[t._v("下面是一个简单的demo,任何对节点的操作都会收到MutationObserver API的通知。")]),t._v(" "),e("h3",{attrs:{id:"demo-🌰↓-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#demo-🌰↓-2","aria-hidden":"true"}},[t._v("#")]),t._v(" demo 🌰↓")]),t._v(" "),e("Observers-MutationObserver"),t._v(" "),e("p",[t._v("主要代码：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("methods"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observerCallBack")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mutations"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//do log")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("onAddAttr")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// toggle attribute 'd'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$list "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js-list'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" config "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \tattributes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    \tchildList"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    \tcharacterData"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \tsubtree"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MutationObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("observerCallBack"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    observer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$list"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br")])]),e("p",[e("a",{attrs:{href:"https://github.com/xiaotianxia/blog/blob/678a850ab72f9c6cc302c5c4dc0ec6f4a61de5d5/docs/.vuepress/components/Observers/MutationObserver.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("完整代码"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"参考资料-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("MutationObserver"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developers.google.com/web/updates/2012/02/Detect-DOM-changes-with-Mutation-Observers",target:"_blank",rel:"noopener noreferrer"}},[t._v("Detect DOM changes with Mutation Observers"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"http://javascript.ruanyifeng.com/dom/mutationobserver.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mutation Observer API"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dev.opera.com/articles/mutation-observers-tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Getting to Know Mutation Observers"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"resize-observer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resize-observer","aria-hidden":"true"}},[t._v("#")]),t._v(" Resize Observer")]),t._v(" "),e("p",[t._v("从名字就可以知道该API是干嘛的了：监听元素的尺寸变化。")]),t._v(" "),e("p",[t._v("之前为了监听元素的尺寸变化，都将侦听器附加到window中的resize事件。对于不受窗口变化影响的元素就没那么简单了。\n现在我们可以使用该API轻松的实现。")]),t._v(" "),e("h3",{attrs:{id:"怎么用-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么用-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 怎么用")]),t._v(" "),e("p",[t._v("同样只需要两步：")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResizeObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nobserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("但是它的触发也是有条件的，下面是触发和不触发的条件：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("触发")]),t._v(" "),e("ul",[e("li",[t._v("1.元素被插入或移除时触发")]),t._v(" "),e("li",[t._v("2.元素display从显示变成 none 或相反过程时触发")])])]),t._v(" "),e("li",[e("p",[t._v("不触发")]),t._v(" "),e("ul",[e("li",[t._v("1.对于不可替换内联元素不触发")]),t._v(" "),e("li",[t._v("2.CSS transform 操作不触发")])])])]),t._v(" "),e("h3",{attrs:{id:"demo-🌰↓-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#demo-🌰↓-3","aria-hidden":"true"}},[t._v("#")]),t._v(" demo 🌰↓")]),t._v(" "),e("Observers-ResizeObserver"),t._v(" "),e("p",[t._v("拖动右下角变换元素尺寸或点击随机按钮设置随机尺寸，都会收到通知(里面的小星星转动速度变化)。\n而通过transform变化视觉上的尺寸时是没有通知的。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/xiaotianxia/blog/blob/678a850ab72f9c6cc302c5c4dc0ec6f4a61de5d5/docs/.vuepress/components/Observers/ResizeObserver.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("完整代码"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("遗憾的是该API仍处于实验阶段，好多浏览器没有实现。")]),t._v(" "),e("CanIUse",{attrs:{word:"resizeobserver"}}),t._v(" "),e("p",[t._v("不过，由于MutationObserver已经被大部分浏览器支持，且有"),e("a",{attrs:{href:"https://github.com/w3c/IntersectionObserver/tree/master/polyfill",target:"_blank",rel:"noopener noreferrer"}},[t._v("polyfill"),e("OutboundLink")],1),t._v("的支持，\n我们可以轻松的利用他来代替ResizeObserver。")]),t._v(" "),e("CanIUse",{attrs:{word:"mutationobserver"}}),t._v(" "),e("h3",{attrs:{id:"推荐阅读"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推荐阅读","aria-hidden":"true"}},[t._v("#")]),t._v(" 推荐阅读")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.w3cplus.com/javascript/ResizeObserver-api.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript中的ResizeObserver"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://wicg.github.io/ResizeObserver/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Resize Observer 1"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://alligator.io/js/resize-observer/",target:"_blank",rel:"noopener noreferrer"}},[t._v("A Look at the Resize Observer JavaScript API"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://pawelgrzybek.com/the-resize-observer-explained/",target:"_blank",rel:"noopener noreferrer"}},[t._v("THE RESIZE OBSERVER EXPLAINED"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"performance-observer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#performance-observer","aria-hidden":"true"}},[t._v("#")]),t._v(" Performance Observer")]),t._v(" "),e("p",[t._v("PerformanceObserver 是个相对比较复杂的API，用来监控各种性能相关的指标。\n该API由一系列API组成：")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/2019/WD-performance-timeline-2-20190321/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Performance Timeline Level 2"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://w3c.github.io/paint-timing/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Paint Timing 1"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://w3c.github.io/navigation-timing/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Navigation Timing Level 2"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/2019/WD-user-timing-3-20190308/",target:"_blank",rel:"noopener noreferrer"}},[t._v("User Timing Level 3"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/2019/WD-resource-timing-2-20190307/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Resource Timing Level 2"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.w3.org/TR/2017/WD-longtasks-1-20170907/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Long Tasks API 1"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("若真细研究起来东西还是很多的,这里只简单地介绍一下（因为我也没搞太清楚😂）。")]),t._v(" "),e("h3",{attrs:{id:"怎么用-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#怎么用-3","aria-hidden":"true"}},[t._v("#")]),t._v(" 怎么用")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PerformanceObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nobserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" entryTypes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("entryTypes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("entryTypes: 需要监控的指标名，这些指标都可以通过 performance.getEntries() 获取到，此外还可以通过 performance.getEntriesByName() 、performance.getEntriesByType()\n分别针对 name 和 entryType 来过滤。")]),t._v(" "),e("ul",[e("li",[t._v("mark 获取所有通过 performance.mark(markName) 做的所有标记")]),t._v(" "),e("li",[t._v("measure 获取通过 performance.measure(measureName, markName_start, markName_end) 得到的所有测量值")]),t._v(" "),e("li",[t._v("longtask 监听长任务（超过50ms 的任务）（不足："),e("strong",[t._v("只能监控到长任务的存在，貌似不能定位到具体任务")]),t._v("）")]),t._v(" "),e("li",[t._v("paint 获取绘制相关的性能指标，分为两种：“first-paint”、“first-contentful-paint”")]),t._v(" "),e("li",[t._v("navigation 各种与页面有关的时间，可通过 performance.timing 获取")]),t._v(" "),e("li",[t._v("resource 各种与资源加载相关的信息")])]),t._v(" "),e("p",[t._v("相较之前的各种操作，现在我们代码仅需要像这样就可以了——")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" observer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PerformanceObserver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("list"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" output"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" item "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" list"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntries")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//业务代码")]),t._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nobserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//按需要填写")]),t._v("\n    entryTypes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mark'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'measure'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'longtask'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'paint'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resource'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("h4",{attrs:{id:"demo-🌰↓-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#demo-🌰↓-4","aria-hidden":"true"}},[t._v("#")]),t._v(" demo 🌰↓")]),t._v(" "),e("spreadown",{attrs:{defaultShow:""}},[e("iframe",{staticStyle:{width:"100%"},attrs:{height:"393",scrolling:"no",title:"PerformanceObserver demo",src:"//codepen.io/_tianxia/embed/oVargZ/?height=393&theme-id=33504&default-tab=js,result",frameborder:"no",allowtransparency:"true",allowfullscreen:"true"}},[t._v("See the Pen "),e("a",{attrs:{href:"https://codepen.io/_tianxia/pen/oVargZ/"}},[t._v("PerformanceObserver demo")]),t._v(" by Denzel("),e("a",{attrs:{href:"https://codepen.io/_tianxia"}},[t._v("@_tianxia")]),t._v(") on "),e("a",{attrs:{href:"https://codepen.io"}},[t._v("CodePen")]),t._v(".")]),t._v(" "),e("show-in-codepen",{attrs:{href:"https://codepen.io/_tianxia/pen/oVargZ"}})],1),t._v(" "),e("p",[t._v("由于时间、精力有限，上述内容如有错误，欢迎不吝赐教🙏。")]),t._v(" "),e("h3",{attrs:{id:"参考资料-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料-3","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver/PerformanceObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("PerformanceObserver()"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.zeolearn.com/magazine/different-types-of-observers-supported-by-modern-browsers",target:"_blank",rel:"noopener noreferrer"}},[t._v("Different Types Of Observers Supported By Modern Browsers"),e("OutboundLink")],1)])])],1)},[],!1,null,null,null);s.default=n.exports}}]);