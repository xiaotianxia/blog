(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{391:function(t,s,i){},591:function(t,s,i){"use strict";var e=i(391);i.n(e).a},647:function(t,s,i){"use strict";i.r(s);var e={data:function(){return{chunks:[],chunkList:[],btnText:"按住拍视频",index:0}},methods:{requestMediaAccess:function(){var t=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(s){t.recorder=new window.MediaRecorder(s),t.stream=s,t.bindEvents()},function(t){alert("出错，请确保已允许浏览器获取音视频权限")})},onMousedown:function(){this.showVideo(!0),this.onPreview(),this.btnText="松开结束",this.onStart()},onMouseup:function(){this.onStop(),this.btnText="按住拍视频"},onPreview:function(){this.video.srcObject=this.stream,this.video.muted=!0,this.video.play()},showVideo:function(t){t?this.video.style.display="block":(this.video.style.display="none",this.video.pause())},onStart:function(){this.recorder.start()},onStop:function(){this.recorder.stop()},onPlay:function(t){this.showVideo(!0);var s=this.chunkList[t];this.video.src=s.stream,this.video.muted=!1,this.video.play(),this.bindAudioEvent()},bindAudioEvent:function(){var t=this;this.video.onended=function(){t.showVideo(!1)}},bindEvents:function(){this.recorder.ondataavailable=this.getRecordingData,this.recorder.onstop=this.saveRecordingData},getRecordingData:function(t){this.chunks.push(t.data)},saveRecordingData:function(){var t=new Blob(this.chunks,{type:"video/webm"}),s=URL.createObjectURL(t);this.chunkList.push({stream:s}),this.onCapture(this.index),this.msgList.scrollBy&&this.msgList.scrollBy({top:500,left:0,behavior:"smooth"}),this.chunks=[]},onCapture:function(t){var s=this,i=this.chunkList[t];this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),this.canvas.toBlob(function(t){var e=URL.createObjectURL(t);s.$set(i,"poster",e)}),this.index++,this.showVideo(!1),this.video.srcObject=null}},mounted:function(){navigator.mediaDevices?window.MediaRecorder?(this.video=this.$refs.video,this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.msgList=document.querySelector(".js-msg-list"),this.requestMediaAccess()):alert("您的浏览器不支持录音"):alert("您的浏览器不支持获取用户设备")}},n=(i(591),i(12)),o=Object(n.a)(e,function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"recorder-wrapper"},[i("div",{staticClass:"phone"},[i("div",{staticClass:"phone-body"},[t._m(0),t._v(" "),i("div",{staticClass:"phone-content"},[i("transition-group",{staticClass:"js-msg-list msg-list",attrs:{tag:"ul",name:"fade"}},[i("li",{key:-1,staticClass:"msg eg"},[i("div",{staticClass:"avatar"}),t._v(" "),i("div",{staticClass:"video"},[t._v("拍段视频吧")])]),t._v(" "),t._l(t.chunkList,function(s,e){return i("li",{key:e,staticClass:"msg"},[i("div",{staticClass:"avatar"}),t._v(" "),i("div",{staticClass:"video",on:{click:function(s){return t.onPlay(e)},touchend:function(s){return s.preventDefault(),t.onPlay(e)}}},[i("img",{attrs:{alt:"截图",src:s.poster}}),t._v(" "),i("i",{staticClass:"el-icon-caret-right"})])])})],2)],1),t._v(" "),i("div",{staticClass:"phone-operate",on:{mousedown:t.onMousedown,touchstart:function(s){return s.preventDefault(),t.onMousedown(s)},mouseup:t.onMouseup,touchend:function(s){return s.preventDefault(),t.onMouseup(s)}}},[t._v(t._s(t.btnText))]),t._v(" "),i("video",{ref:"video",attrs:{width:"200"},on:{click:function(s){return t.showVideo(!1)},touchend:function(s){return s.preventDefault(),t.showVideo(!1)}}})])]),t._v(" "),i("canvas",{ref:"canvas"})])},[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"phone-head"},[s("span",[this._v("< 微信(66)")]),this._v(" "),s("span",[this._v("哈哈哈")]),this._v(" "),s("span",[this._v("···")])])}],!1,null,"b4e3a46c",null);s.default=o.exports}}]);